{% extends 'base.html' %}

{% block title %}Wiki - Документация платформы cysu{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-3">
            <div class="card border-0" style="background: var(--dp-02); border: 1px solid var(--border-primary) !important;">
                <div class="card-header" style="background: var(--dp-03); border-bottom: 1px solid var(--border-secondary); color: var(--text-primary);">
                    <h5 class="mb-0"><i class="fas fa-book me-2"></i>Содержание</h5>
                </div>
                <div class="card-body p-0">
                    <nav class="nav flex-column">
                        <a class="nav-link text-light py-2 px-3" href="#getting-started" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-rocket me-2 text-primary"></i>Начало работы
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#groups" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-users me-2 text-primary"></i>Система групп
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#subjects" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-graduation-cap me-2 text-primary"></i>Предметы
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#subscription" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-credit-card me-2 text-primary"></i>Подписка
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#profile" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-user me-2 text-primary"></i>Профиль
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#support" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-headset me-2 text-primary"></i>Поддержка
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#features" style="border-bottom: 1px solid var(--border-primary);">
                            <i class="fas fa-cogs me-2 text-primary"></i>Возможности
                        </a>
                        <a class="nav-link text-light py-2 px-3" href="#faq" style="/*border-bottom: 1px solid var(--border-primary);*/">
                            <i class="fas fa-question-circle me-2 text-primary"></i>FAQ
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        
        <div class="col-lg-9">
            <div class="card border-0" style="background: var(--dp-02); border: 1px solid var(--border-primary) !important;">
                <div class="card-header" style="background: var(--dp-03); border-bottom: 1px solid var(--border-secondary); color: var(--text-primary);">
                    <h1 class="h3 mb-0"><i class="fas fa-book me-3"></i>Wiki - Документация платформы cysu</h1>
                </div>
                <div class="card-body">
                    <section id="getting-started" class="mb-5">
                        <h2 class="text-primary mb-4">Начало работы</h2>
                        <p class="text-light">Добро пожаловать в Wiki платформы cysu. Здесь вы найдете всю необходимую информацию для работы с образовательной платформой.</p>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="p-4 text-center" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 20px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                                    <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                                    <h6 class="text-primary mb-2">Регистрация</h6>
                                    <p class="text-muted small mb-0">Создайте аккаунт и выберите группу</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-4 text-center" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 20px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                                    <i class="fas fa-credit-card fa-3x text-primary mb-3"></i>
                                    <h6 class="text-primary mb-2">Подписка</h6>
                                    <p class="text-muted small mb-0">Оформите подписку для доступа</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-4 text-center" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 20px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                                    <i class="fas fa-graduation-cap fa-3x text-primary mb-3"></i>
                                    <h6 class="text-primary mb-2">Изучение</h6>
                                    <p class="text-muted small mb-0">Выберите предмет и начните обучение</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="groups" class="mb-5">
                        <h2 class="text-primary mb-4">Система групп</h2>
                        <p class="text-light">Платформа использует систему групп для организации образовательного процесса:</p>
                        <div class="text-light">
                            <div class="mb-2">• Каждый пользователь при регистрации получает группу</div>
                            <div class="mb-2">• Группа определяет доступные предметы</div>
                            <div class="mb-2">• Предмет может быть доступен в нескольких группах</div>
                            <div class="mb-2">• Администраторы могут изменять группу пользователя</div>
                            <div class="mb-2">• Группа назначается автоматически при регистрации</div>
                        </div>
                        
                        <div class="mt-3 p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                            <h6 class="text-primary"><i class="fas fa-info-circle me-2"></i>Как работает система групп</h6>
                            <p class="text-muted small mb-0">При регистрации система автоматически определяет подходящую группу на основе доступных опций. Администраторы могут вручную изменить группу пользователя через панель управления.</p>
                        </div>
                    </section>

                    <section id="subjects" class="mb-5">
                        <h2 class="text-primary mb-4">Предметы</h2>
                        <p class="text-light">Доступ к предметам зависит от вашей группы:</p>
                        <div class="text-light">
                            <div class="mb-2">• Просматривайте только предметы вашей группы</div>
                            <div class="mb-2">• Каждый предмет имеет уникальный визуальный паттерн</div>
                            <div class="mb-2">• Материалы обновляются регулярно</div>
                            <div class="mb-2">• Предметы могут быть доступны в нескольких группах</div>
                            <div class="mb-2">• Контент адаптируется под уровень группы</div>
                        </div>
                        
                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <div class="p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                                    <h6 class="text-primary"><i class="fas fa-eye me-2"></i>Доступные предметы</h6>
                                    <p class="text-muted small mb-0">В вашей группе доступны все предметы, которые администратор назначил для данной группы. Это обеспечивает структурированное обучение.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                                    <h6 class="text-primary"><i class="fas fa-palette me-2"></i>Визуальные паттерны</h6>
                                    <p class="text-muted small mb-0">Каждый предмет имеет уникальный SVG паттерн, который остается неизменным при перезагрузке страницы для лучшего восприятия.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="subscription" class="mb-5">
                        <h2 class="text-primary mb-4">Подписка</h2>
                        <p class="text-light">Для доступа к материалам необходима активная подписка:</p>
                        <div class="text-light">
                            <div class="mb-2">• Без подписки доступ ограничен</div>
                            <div class="mb-2">• Подписка дает полный доступ к материалам</div>
                            <div class="mb-2">• Автоматическое продление</div>
                            <div class="mb-2">• Возможность отмены в любое время</div>
                            <div class="mb-2">• Безопасные платежи через ЮKassa</div>
                        </div>
                        
                        <div class="mt-3 p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                            <h6 class="text-primary"><i class="fas fa-credit-card me-2"></i>Тарифы подписки</h6>
                            <div class="row g-2 text-center">
                                <div class="col-3">
                                    <div class="p-2" style="background: var(--dp-02); border-radius: 6px;">
                                        <div class="text-primary fw-bold">89₽</div>
                                        <small class="text-muted">1 месяц</small>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="p-2" style="background: var(--dp-02); border-radius: 6px;">
                                        <div class="text-primary fw-bold">199₽</div>
                                        <small class="text-muted">3 месяца</small>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="p-2" style="background: var(--dp-01); border-radius: 6px;">
                                        <div class="text-primary fw-bold">349₽</div>
                                        <small class="text-muted">6 месяцев</small>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="p-2" style="background: var(--dp-01); border-radius: 6px;">
                                        <div class="text-primary fw-bold">469₽</div>
                                        <small class="text-muted">1 год</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="profile" class="mb-5">
                        <h2 class="text-primary mb-4">Профиль пользователя</h2>
                        <p class="text-light">В профиле вы можете:</p>
                        <div class="text-light">
                            <div class="mb-2">• Просматривать информацию о группе</div>
                            <div class="mb-2">• Управлять настройками аккаунта</div>
                            <div class="mb-2">• Отслеживать активность</div>
                            <div class="mb-2">• Просматривать историю подписок</div>
                            <div class="mb-2">• Изменять личные данные</div>
                        </div>
                        
                        <div class="mt-3 p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                            <h6 class="text-primary"><i class="fas fa-user-cog me-2"></i>Управление профилем</h6>
                            <p class="text-muted small mb-0">Профиль содержит всю важную информацию о вашем аккаунте, включая назначенную группу, статус подписки и настройки безопасности.</p>
                        </div>
                    </section>

                    <section id="support" class="mb-5">
                        <h2 class="text-primary mb-4">Поддержка</h2>
                        <p class="text-light">Если у вас возникли вопросы:</p>
                        <div class="text-light">
                            <div class="mb-2">• Используйте систему тикетов</div>
                            <div class="mb-2">• Обратитесь к администратору</div>
                            <div class="mb-2">• Проверьте данную документацию</div>
                            <div class="mb-2">• Напишите в Telegram: @cy7su</div>
                            <div class="mb-2">• Отправьте email: support@cysu.ru</div>
                        </div>
                        
                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <div class="p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                                    <h6 class="text-primary"><i class="fas fa-ticket-alt me-2"></i>Система тикетов</h6>
                                    <p class="text-muted small mb-0">Создавайте тикеты для решения технических проблем или получения помощи по использованию платформы.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                                    <h6 class="text-primary"><i class="fas fa-headset me-2"></i>Онлайн поддержка</h6>
                                    <p class="text-muted small mb-0">Получите быструю помощь через Telegram или email. Время ответа обычно составляет несколько часов.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="features" class="mb-5">
                        <h2 class="text-primary mb-4">Возможности платформы</h2>
                        <p class="text-light">cysu предоставляет широкий спектр образовательных возможностей:</p>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="p-4 text-center" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 20px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                                    <i class="fas fa-book-open fa-3x text-primary mb-3"></i>
                                    <h6 class="text-primary mb-2">Учебные материалы</h6>
                                    <p class="text-muted small mb-0">Структурированный контент с теорией и практикой</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-4 text-center" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 20px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                                    <i class="fas fa-upload fa-3x text-primary mb-3"></i>
                                    <h6 class="text-primary mb-2">Загрузка решений</h6>
                                    <p class="text-muted small mb-0">Отправляйте выполненные задания на проверку</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-4 text-center" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 20px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
                                    <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                                    <h6 class="text-primary mb-2">Прогресс обучения</h6>
                                    <p class="text-muted small mb-0">Отслеживайте свой прогресс по предметам</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="faq" class="mb-5">
                        <h2 class="text-primary mb-4">Часто задаваемые вопросы</h2>
                        
                        <div class="accordion" id="faqAccordion">
                            <div class="accordion-item" style="background: var(--dp-03); border: 1px solid var(--border-secondary);">
                                <h2 class="accordion-header" id="faq1">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1" style="background: var(--dp-03); color: var(--text-primary); border: none;">
                                        Как изменить группу?
                                    </button>
                                </h2>
                                <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body" style="background: var(--dp-02); color: var(--text-primary);">
                                        Группа назначается автоматически при регистрации. Для изменения группы обратитесь к администратору через систему тикетов.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item" style="background: var(--dp-03); border: 1px solid var(--border-secondary);">
                                <h2 class="accordion-header" id="faq2">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2" style="background: var(--dp-03); color: var(--text-primary); border: none;">
                                        Можно ли отменить подписку?
                                    </button>
                                </h2>
                                <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body" style="background: var(--dp-02); color: var(--text-primary);">
                                        Да, подписку можно отменить в любое время. После отмены доступ к материалам сохранится до конца оплаченного периода.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item" style="background: var(--dp-03); border: 1px solid var(--border-secondary);">
                                <h2 class="accordion-header" id="faq3">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3" style="background: var(--dp-03); color: var(--text-primary); border: none;">
                                        Что делать, если забыл пароль?
                                    </button>
                                </h2>
                                <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body" style="background: var(--dp-02); color: var(--text-primary);">
                                        Используйте функцию восстановления пароля на странице входа. Новый пароль будет отправлен на ваш email.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <div class="mt-4 p-3" style="background: var(--dp-03); border: 1px solid var(--border-secondary); border-radius: 8px;">
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Совет:</strong> Для получения полного доступа к материалам необходимо оформить подписку. Система автоматически назначит вас в группу при регистрации.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Стили для аккордеона FAQ */
    #faqAccordion .accordion-button:not(.collapsed) {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%) !important;
        color: var(--text-primary) !important;
        box-shadow: none !important;
    }
    
    #faqAccordion .accordion-button:focus {
        box-shadow: 0 0 0 0.25rem rgba(181, 149, 255, 0.25) !important;
        border-color: var(--primary-color) !important;
    }
    
    #faqAccordion .accordion-button::after {
        filter: invert(1) !important;
    }
    
    /* Hover эффекты отключены */

    
    .sidebar-heading {
        font-size: .875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .navbar-brand {
        padding-top: .75rem;
        padding-bottom: .75rem;
        font-size: 1rem;
        background-color: var(--dp-01);
        box-shadow: inset -1px 0 0 var(--border-primary);
    }
    
    .navbar .navbar-toggler {
        top: .25rem;
        right: 1rem;
    }
    
    .navbar .form-control {
        padding: .75rem 1rem;
        border-width: 0;
        border-radius: 0;
    }
    
    .form-control-dark {
        color: var(--text-primary);
        background-color: var(--dp-01);
        border-color: var(--border-secondary);
    }
    
    .form-control-dark:focus {
        border-color: transparent;
        box-shadow: 0 0 0 3px rgba(181, 149, 255, 0.25);
    }
    
    /* Плавная прокрутка */
    html {
        scroll-behavior: smooth;
    }
    
    /* Стили для печати */
    @media print {
        .sidebar, .btn-toolbar, .offcanvas, .position-fixed {
            display: none !important;
        }
        
        .col-md-9 {
            width: 100% !important;
            margin-left: 0 !important;
        }
    }
    
    /* Базовые стили для карточек */
    .card {
        border: none;
        border-radius: 0;
    }
    
    /* Стили для card-body в wiki */
    .wiki-page .card-body {
        background: transparent !important;
        border-bottom-left-radius: 20px !important;
        border-bottom-right-radius: 20px !important;
        padding: 2rem !important;
        border: none !important;
        box-shadow: none !important;
    }
    
    .wiki-page .card-header {
        background: transparent !important;
        border-bottom: 1px solid var(--border-secondary) !important;
        border-radius: 0 !important;
        padding: 1.5rem 2rem !important;
        border-top: none !important;
        border-left: none !important;
        border-right: none !important;
    }
    
    /* Стили для карточек ролей пользователей */
    .wiki-page .row .card {
        background: transparent !important;
        border: none !important;
        border-radius: 0 0 20px 20px !important;
        overflow: hidden !important;
        box-shadow: none !important;
    }
    
    .wiki-page .row .card .card-header {
        background: transparent !important;
        border: none !important;
        border-radius: 0 !important;
        padding: 1rem 1.5rem !important;
    }
    
    .wiki-page .row .card .card-body {
        background: transparent !important;
        border: none !important;
        border-radius: 0 0 20px 20px !important;
        padding: 1.5rem !important;
    }
    
    .wiki-page .card {
        border: none !important;
        border-radius: 0 !important;
        background: transparent !important;
        box-shadow: none !important;
        overflow: visible !important;
    }
    
    /* Отключаем базовые стили карточек для wiki */
    .wiki-page .card * {
        color: var(--text-primary) !important;
    }
    
    /* Переопределяем стили из base.html */
    .wiki-page .card {
        background: transparent !important;
        border: none !important;
        border-radius: 0 !important;
        overflow: visible !important;
        box-shadow: none !important;
    }
    
    /* Стили для аккордеона */
    .wiki-page .accordion {
        background: transparent !important;
        border: none !important;
    }
    
    .wiki-page .accordion-item {
        background: linear-gradient(135deg, var(--dp-01) 0%, var(--dp-03) 100%) !important;
        border: 1px solid var(--border-secondary) !important;
        border-radius: 15px !important;
        margin-bottom: 0.5rem !important;
    }
    
    .wiki-page .accordion-button {
        background: linear-gradient(135deg, var(--dp-03) 0%, var(--dp-01) 100%) !important;
        color: var(--text-primary) !important;
        border: none !important;
        border-radius: 15px !important;
        padding: 1rem 1.5rem !important;
    }
    
    .wiki-page .accordion-button:not(.collapsed) {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%) !important;
        color: var(--text-primary) !important;
        box-shadow: none !important;
    }
    
    .wiki-page .accordion-button:focus {
        box-shadow: 0 0 0 0.25rem rgba(181, 149, 255, 0.25) !important;
        background: linear-gradient(135deg, var(--dp-03) 0%, var(--dp-01) 100%) !important;
    }
    
    .wiki-page .accordion-button:hover {
        background: linear-gradient(135deg, var(--dp-04) 0%, var(--dp-03) 100%) !important;
    }
    
    .wiki-page .accordion-button:not(.collapsed):hover {
        background: linear-gradient(135deg, var(--primary-hover) 0%, var(--primary-color) 100%) !important;
    }
    
    .wiki-page .accordion-body {
        background: linear-gradient(135deg, var(--dp-01) 0%, var(--dp-03) 100%) !important;
        color: var(--text-primary) !important;
        border-top: 1px solid var(--border-secondary) !important;
        padding: 1.5rem !important;
    }
    
    .wiki-page .accordion-button::after {
        filter: invert(1) brightness(2);
    }
    
    /* Стили для навигации */
    /* Hover эффекты отключены */
    
    .wiki-page .sidebar .nav-link.active {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%) !important;
        color: var(--text-primary) !important;
        border-color: var(--primary-color) !important;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
// Плавная прокрутка к якорям
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Подсветка активного раздела в навигации
window.addEventListener('scroll', function() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.sidebar .nav-link');
    
    let current = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (pageYOffset >= sectionTop - 200) {
            current = section.getAttribute('id');
        }
    });
    
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
        }
    });
});

// Функция копирования ссылки на страницу
function copyPageUrl() {
    navigator.clipboard.writeText(window.location.href).then(() => {
        // Показываем уведомление о копировании
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Скопировано!';
        button.style.background = 'var(--success)';
        button.style.borderColor = 'var(--success)';
        button.style.color = 'var(--text-primary)';
        
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '';
            button.style.borderColor = 'var(--success)';
            button.style.color = 'var(--success)';
        }, 2000);
    }).catch(err => {
        console.error('Ошибка копирования:', err);
        alert('Не удалось скопировать ссылку');
    });
}

// Автоматическое скрытие мобильного меню при клике на ссылку
document.querySelectorAll('#mobileNav .nav-link').forEach(link => {
    link.addEventListener('click', function() {
        const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('mobileNav'));
        if (offcanvas) {
            offcanvas.hide();
        }
    });
});

// Убрана анимация появления элементов при скролле
</script>
{% endblock %}