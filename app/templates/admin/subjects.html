{% extends 'base.html' %}
{% from 'macros/breadcrumbs.html' import admin_breadcrumb %}

{% block title %}Админка: Предметы{% endblock %}

{% block breadcrumbs %}
{{ admin_breadcrumb("Предметы") }}
{% endblock %}

{% block content %}
<div class="container-fluid admin-subjects">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Управление предметами</h2>
    <span class="badge bg-primary fs-6">{{ subjects|length }} предметов</span>
  </div>

  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card shadow-sm border-0" style="background: var(--dp-02); height: fit-content;">
        <div class="card-body">
          <h5 class="card-title mb-3">
            <i class="fas fa-plus me-2 text-primary"></i>Создать предмет
          </h5>
          <form method="post">
            {{ form.hidden_tag() }}
            <div class="mb-3">
              <label for="{{ form.title.id }}" class="form-label">Название предмета</label>
              {{ form.title(class_='form-control', placeholder='Введите название предмета', style='background: var(--dp-01); border: 1px solid var(--border-secondary); color: var(--text-primary); border-radius: 20px;') }}
              {% if form.title.errors %}
                <div class="text-danger small">
                  {% for error in form.title.errors %}
                    {{ error }}
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <div class="mb-3">
              <label for="{{ form.description.id }}" class="form-label">Описание</label>
              {{ form.description(class_='form-control', placeholder='Введите описание предмета', style='background: var(--dp-01); border: 1px solid var(--border-secondary); color: var(--text-primary); border-radius: 20px; min-height: 80px; height: 95px; resize: vertical;') }}
              {% if form.description.errors %}
                <div class="text-danger small">
                  {% for error in form.description.errors %}
                    {{ error }}
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <button type="submit" class="btn btn-primary text-white w-100" style="color: #fff !important; border-radius: 20px;">
              <i class="fas fa-plus me-2"></i>Создать предмет
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card shadow-sm border-0" style="background: var(--dp-02);">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table mb-0" style="background: var(--dp-02); color: var(--text-primary);">
              <thead style="background: var(--dp-03);">
                <tr>
                  <th class="border-0" style="color: var(--text-primary);">ID</th>
                  <th class="border-0" style="color: var(--text-primary);">Название</th>
                  <th class="border-0" style="color: var(--text-primary);">Описание</th>
                  <th class="border-0" style="color: var(--text-primary);">Материалы</th>
                  <th class="border-0" style="color: var(--text-primary);">Действия</th>
                </tr>
              </thead>
              <tbody style="background: var(--dp-02);">
                {% for subject in subjects %}
                <tr style="border-color: var(--border-secondary); background: var(--dp-02); color: var(--text-primary);">
                  <td style="color: var(--text-primary);"><span class="badge bg-secondary">{{ subject.id }}</span></td>
                  <td style="color: var(--text-primary);">
                    <strong>{{ subject.title }}</strong>
                  </td>
                  <td style="color: var(--text-primary);">
                    <small class="text-muted">{{ subject.description[:100] }}{% if subject.description|length > 100 %}...{% endif %}</small>
                  </td>
                  <td style="color: var(--text-primary);">
                    <span class="badge bg-info">{{ subject.materials|length }} материалов</span>
                  </td>
                  <td style="color: var(--text-primary);">
                    <div class="btn-group btn-group-sm" role="group">
                      <a href="{{ url_for('main.subject_detail', subject_id=subject.id) }}" class="btn btn-outline-primary" title="Просмотр">
                        <i class="fas fa-eye"></i>
                      </a>
                      <form method="post" action="{{ url_for('main.delete_subject', subject_id=subject.id) }}" style="display: inline;" onsubmit="return confirm('Удалить предмет?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-outline-danger" title="Удалить">
                          <i class="fas fa-trash"></i>
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% else %}
                <tr style="border-color: var(--border-secondary); background: var(--dp-02); color: var(--text-primary);">
                  <td colspan="5" class="text-center text-muted py-4">
                    <i class="fas fa-inbox fa-2x mb-3"></i>
                    <p class="mb-0">Нет предметов</p>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const patternSelect = document.getElementById('pattern-select');
    const patternPreview = document.getElementById('pattern-preview');
    
    // Функция обновления предварительного просмотра
    function updatePatternPreview() {
        const selectedPattern = patternSelect.value;
        if (selectedPattern) {
            const pattern = SVGPatternGenerator.generatePattern(selectedPattern);
            patternPreview.style.backgroundImage = `url("data:image/svg+xml;base64,${btoa(pattern)}")`;
        } else {
            patternPreview.style.backgroundImage = 'none';
        }
    }
    
    // Обработчик изменения выбора паттерна
    patternSelect.addEventListener('change', updatePatternPreview);
    
    // Инициализация предварительного просмотра
    updatePatternPreview();
});
</script>
{% endblock %} 