{% extends "base.html" %} {% from 'macros/breadcrumbs.html' import admin_breadcrumb %} {% block title %}Управление
материалами{% endblock %} {% block breadcrumbs %} {{ admin_breadcrumb("Материалы") }} {% endblock %} {% block content %}
<div class="admin-page">
    <!-- Заголовок страницы -->
    <div class="admin-header">
        <div class="admin-header-content">
            <div class="admin-title-section">
                <h1 class="admin-title">
                    <i class="fas fa-file-alt admin-title-icon"></i>
                    Управление материалами
                </h1>
                <p class="admin-subtitle">Просмотр и управление материалами системы</p>
            </div>
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number">{{ materials|length }}</div>
                    <div class="stat-label">Материалов</div>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-content">
        <div class="admin-layout">
            <!-- Основной контент -->
            <div class="admin-main" style="grid-column: 1 / -1">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i class="fas fa-list"></i>
                            Список материалов
                        </h3>
                        <div class="admin-card-actions">
                            <button class="btn btn-outline-secondary btn-sm" onclick="refreshTable()">
                                <i class="fas fa-sync-alt"></i>
                                Обновить
                            </button>
                        </div>
                    </div>

                    <div class="admin-card-body p-0">
                        {% if materials %}
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th class="admin-table-th">
                                            <i class="fas fa-tag"></i>
                                            Название
                                        </th>
                                        <th class="admin-table-th">
                                            <i class="fas fa-book"></i>
                                            Предмет
                                        </th>
                                        <th class="admin-table-th">
                                            <i class="fas fa-file"></i>
                                            Тип
                                        </th>
                                        <th class="admin-table-th">
                                            <i class="fas fa-download"></i>
                                            Файл
                                        </th>
                                        <th class="admin-table-th">
                                            <i class="fas fa-cogs"></i>
                                            Действия
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for material in materials %}
                                    <tr class="admin-table-row">
                                        <td class="admin-table-td">
                                            <div class="admin-table-cell-content">
                                                <strong class="admin-table-cell-title">{{ material.title }}</strong>
                                            </div>
                                        </td>
                                        <td class="admin-table-td">
                                            <div class="admin-table-cell-content">
                                                <span class="admin-badge admin-badge-primary"
                                                    >{{ material.subject.title }}</span
                                                >
                                            </div>
                                        </td>
                                        <td class="admin-table-td">
                                            <div class="admin-table-cell-content">
                                                <span class="admin-badge admin-badge-info">{{ material.type }}</span>
                                            </div>
                                        </td>
                                        <td class="admin-table-td">
                                            <div class="admin-table-cell-content">
                                                {% if material.file %}
                                                <a
                                                    href="{{ url_for('main.serve_file', subject_id=material.subject_id, filename=material.file | extract_filename) }}"
                                                    class="admin-link admin-link-primary"
                                                    target="_blank"
                                                >
                                                    <i class="fas fa-download"></i>
                                                    <span>Скачать</span>
                                                </a>
                                                {% else %}
                                                <span class="admin-text-muted">Нет файла</span>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td class="admin-table-td">
                                            <div class="admin-table-actions">
                                                {% if material.file %}
                                                <button
                                                    type="button"
                                                    class="btn btn-outline-primary admin-btn-action"
                                                    title="Заменить файл"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#replaceFileModal{{ material.id }}"
                                                >
                                                    <i class="fas fa-exchange-alt"></i>
                                                </button>
                                                {% endif %}
                                                <form
                                                    method="post"
                                                    action="{{ url_for('main.delete_material', material_id=material.id) }}"
                                                    class="admin-form-inline"
                                                    id="deleteMaterialAdminForm{{ material.id }}"
                                                >
                                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                                    <button
                                                        type="button"
                                                        class="btn btn-outline-danger admin-btn-action"
                                                        title="Удалить"
                                                        onclick="customConfirm('Удалить материал?', function() { document.getElementById('deleteMaterialAdminForm{{ material.id }}').submit(); })"
                                                    >
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr class="admin-table-row">
                                        <td colspan="5" class="admin-empty-state">
                                            <div class="admin-empty-icon">
                                                <i class="fas fa-file-alt"></i>
                                            </div>
                                            <h3 class="admin-empty-title">Нет материалов</h3>
                                            <p class="admin-empty-description">
                                                Материалы появятся здесь после загрузки
                                            </p>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальные окна замены файлов для каждого материала -->
{% for material in materials %} {% if material.file %}
<div
    class="modal fade"
    id="replaceFileModal{{ material.id }}"
    tabindex="-1"
    aria-labelledby="replaceFileModalLabel{{ material.id }}"
    aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="replaceFileModalLabel{{ material.id }}">
                    <i class="fas fa-exchange-alt me-2"></i>Замена файла материала
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form
                method="POST"
                action="{{ url_for('main.replace_material_file', material_id=material.id) }}"
                enctype="multipart/form-data"
            >
                <div class="modal-body">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Внимание!</strong> Старый файл будет удален и заменен новым.
                    </div>

                    <div class="mb-3">
                        <label for="file{{ material.id }}" class="form-label">Выберите новый файл</label>
                        <input
                            type="file"
                            class="form-control"
                            id="file{{ material.id }}"
                            name="file"
                            required
                            accept=".pdf,.docx,.doc,.zip,.ipynb,.py,.txt"
                        />
                        <div class="form-text">
                            Допустимые форматы: PDF, DOCX, ZIP, IPYNB, PY, TXT. Макс. размер: 1 ГБ
                        </div>
                    </div>

                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">Текущий файл</h6>
                            <p class="card-text mb-0">
                                <a
                                    href="{{ url_for('main.serve_file', subject_id=material.subject_id, filename=material.file | extract_filename) }}"
                                    target="_blank"
                                >
                                    <i class="fas fa-file me-1"></i>{{ material.file | extract_filename }}
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Отмена
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload me-1"></i>Заменить файл
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %} {% endfor %} {% endblock %}
