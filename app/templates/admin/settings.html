{% extends "base.html" %}
{% from 'macros/breadcrumbs.html' import admin_breadcrumb %}

{% block title %}Настройки сайта - cysu{% endblock %}

{% block breadcrumbs %}
{{ admin_breadcrumb("Настройки") }}
{% endblock %}

{% block content %}
<div class="admin-users">
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card" style="background: var(--dp-01); border: 1px solid var(--border-primary); border-radius: 20px;">
            <div class="card-header" style="background: var(--dp-03); border-bottom: 1px solid var(--border-secondary);">
                <h4 class="mb-0" style="color: var(--text-primary);">
                    <i class="fas fa-cogs me-2"></i>Настройки сайта
                </h4>
            </div>
            <div class="card-body" style="background: var(--dp-02);">
                <form method="POST">
                    {{ form.csrf_token }}
                    
                    <div class="mb-4">
                        <h5 class="mb-3" style="color: var(--text-primary);">
                            <i class="fas fa-tools me-2"></i>Основные настройки
                        </h5>
                        
                        <div class="form-check form-switch mb-3">
                            {{ form.maintenance_mode(class="form-check-input", id="maintenance_mode", style="background-color: var(--dp-02); border-color: var(--border-secondary);") }}
                            <label class="form-check-label" for="maintenance_mode" style="color: var(--text-primary);">
                                <strong>{{ form.maintenance_mode.label }}</strong>
                            </label>
                            <div class="form-text text-muted" style="color: var(--text-secondary);">
                                <i class="fas fa-info-circle me-1"></i>
                                При включении все пользователи (кроме администраторов) будут видеть страницу технических работ
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            {{ form.trial_subscription_enabled(class="form-check-input", id="trial_subscription_enabled", style="background-color: var(--dp-02); border-color: var(--border-secondary);") }}
                            <label class="form-check-label" for="trial_subscription_enabled" style="color: var(--text-primary);">
                                <strong>{{ form.trial_subscription_enabled.label }}</strong>
                            </label>
                            <div class="form-text text-muted" style="color: var(--text-secondary);">
                                <i class="fas fa-info-circle me-1"></i>
                                При включении новые пользователи автоматически получат пробную подписку
                            </div>
                        </div>
                        
                        <div class="mb-3" id="trial-days-group">
                            <label class="form-label" for="trial_subscription_days" style="color: var(--text-primary);">
                                <strong>{{ form.trial_subscription_days.label }}</strong>
                            </label>
                            {{ form.trial_subscription_days(class="form-control", id="trial_subscription_days", style="background-color: var(--dp-02); border-color: var(--border-secondary); color: var(--text-primary);", min="1", max="365") }}
                            <div class="form-text text-muted" style="color: var(--text-secondary);">
                                <i class="fas fa-info-circle me-1"></i>
                                Укажите количество дней для пробной подписки (от 1 до 365 дней)
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            {{ form.pattern_generation_enabled(class="form-check-input", id="pattern_generation_enabled", style="background-color: var(--dp-02); border-color: var(--border-secondary);") }}
                            <label class="form-check-label" for="pattern_generation_enabled" style="color: var(--text-primary);">
                                <strong>{{ form.pattern_generation_enabled.label }}</strong>
                            </label>
                            <div class="form-text text-muted" style="color: var(--text-secondary);">
                                <i class="fas fa-info-circle me-1"></i>
                                При включении администраторы смогут генерировать новые паттерны для карточек предметов
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-primary" style="background: var(--primary-color); border-color: var(--primary-color); color: var(--text-primary); padding: 0.75rem 1.5rem; font-weight: 500; border-radius: 8px;">
                            <i class="fas fa-save me-2"></i>Сохранить настройки
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const trialEnabledSwitch = document.getElementById('trial_subscription_enabled');
    const trialDaysGroup = document.getElementById('trial-days-group');
    
    function toggleTrialDaysField() {
        if (trialEnabledSwitch.checked) {
            trialDaysGroup.style.display = 'block';
        } else {
            trialDaysGroup.style.display = 'none';
        }
    }
    
    // Инициализируем состояние при загрузке
    toggleTrialDaysField();
    
    // Обрабатываем изменения переключателя
    trialEnabledSwitch.addEventListener('change', toggleTrialDaysField);
});
</script>
{% endblock %}
